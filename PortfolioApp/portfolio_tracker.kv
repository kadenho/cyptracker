#:import Factory kivy.factory.Factory
#:import SwapTransition kivy.uix.screenmanager.SwapTransition
#:import SlideTransition kivy.uix.screenmanager.SlideTransition
#:import text_color_from_value portfolio_tracker.text_color_from_value
#:import popup_update_text_size portfolio_tracker.popup_update_text_size

ScreenManager:

    Screen:
        name: 'Menu'

        Label:
            text: app.title_text
            color: (0, 0, 0, 1)
            pos_hint: {'center': (0.5, 0.8)}
            font_size: 36
            text_size: self.size
            halign: 'center'
            valign: 'middle'

        BoxLayout:
            orientation: 'vertical'
            size_hint: (1.0,0.8)
            pos_hint: {'center': (0.5,0.4)}
            padding: (0, 100, 0, 50)
            spacing: 50

            CustomButton:
                text: 'Add New Cryptocurrency'
                text_color: (0.8, 0.8, 0.8, 1)
                size_hint_x: 0.8
                pos_hint: {'x': 0.5 - self.size[0]/(2*self.parent.size[0])}
                on_press:
                    root.transition.direction =  'up'
                    root.current = 'New Cryptocurrency'


            CustomButton:
                text: 'Portfolio Entries'
                text_color: (0.8, 0.8, 0.8, 1)
                size_hint_x: 0.8
                pos_hint: {'x': 0.5 - self.size[0]/(2*self.parent.size[0])}
                on_press:
                    root.transition.direction = 'right'
                    root.current = 'Portfolio Entries'

            CustomButton:
                text: 'Check Portfolio Value'
                text_color: (0.8, 0.8, 0.8, 1)
                size_hint_x: 0.8
                pos_hint: {'x': 0.5 - self.size[0]/(2*self.parent.size[0])}
                on_press:
                    root.transition.direction = 'down'
                    root.current = 'Check Portfolio'

            CustomButton:
                text: 'Change Color'
                text_color: (0.8, 0.8, 0.8, 1)
                size_hint_x: 0.8
                pos_hint: {'x': 0.5 - self.size[0]/(2*self.parent.size[0])}
                on_press:
                    root.transition.direction = 'left'
                    root.current = 'Change Color'

    Screen:
        name: 'New Cryptocurrency'

        Label:
            text: 'New Cryptocurrency'
            pos_hint: {'center': (0.5, 0.9)}
            font_size: 24
            text_size: self.size
            halign: 'center'
            valign: 'middle'

        BoxLayout:
            orientation: 'vertical'
            size_hint: (1,0.8)
            pos_hint: {'center': (0.5,0.4)}
            padding: (0, 0, 0, 50)
            spacing: 20

            Label:
                text: 'Please add a new cryptocurrency to the database.'
                pos_hint: {'center': (0.5, 0.5)}
                text_size: self.size
                halign: 'center'
                valign: 'middle'
            Label:
                text: 'Name'
                text_size: self.size
                halign: 'center'
                valign: 'middle'

            TextInput:
                id: crypto_name
                hint_text: 'Bitcoin'
                size_hint_x: 0.8
                pos_hint: {'x': 0.5 - self.size[0]/(2*self.parent.size[0])}

            Label:
                text: 'Symbol'
                text_size: self.size
                halign: 'center'
                valign: 'middle'

            TextInput:
                id: crypto_symbol
                hint_text: 'btc'
                size_hint_x: 0.8
                pos_hint: {'x': 0.5 - self.size[0]/(2*self.parent.size[0])}

            CustomButton:
                text: 'Add Cryptocurrency'
                size_hint_x: 0.5
                pos_hint: {'x': 0.25}
                on_press:
                    app.add_crypto(name=root.ids.crypto_name.text, symbol=root.ids.crypto_symbol.text)

            CustomButton:
                text: 'Return to Menu'
                pos_hint: {'x': 0.5 - self.size[0]/(2*self.parent.size[0])}
                size_hint_x: 0.75
                on_press:
                    root.transition.direction =  'down'
                    root.current = 'Menu'

    Screen:
        name: 'Portfolio Entries'

        Label:
            text: 'Portfolio Entries'
            pos_hint: {'center': (0.5, 0.9)}
            size_hint: (1.0,0.1)
            font_size: 24
            text_size: self.size
            halign: 'center'
            valign: 'middle'

        BoxLayout:
            orientation: 'vertical'
            size_hint: (1,0.8)
            pos_hint: {'center': (0.5,0.4)}
            padding: (0, 0, 0, 50)
            spacing: 50

            CustomButton:
                text: 'Add Portfolio Entry'
                size_hint_x: 0.5
                pos_hint: {'x': 0.5 - self.size[0]/(2*self.parent.size[0])}
                on_press:
                    root.transition.direction =  'up'
                    root.current = 'Add Portfolio Entry'

            CustomButton:
                text: 'Update Portfolio Entry'
                size_hint_x: 0.5
                pos_hint: {'x': 0.5 - self.size[0]/(2*self.parent.size[0])}
                on_press:
                    root.transition.direction =  'right'
                    root.current = 'Update Portfolio Entry'

            CustomButton:
                text: 'Delete Portfolio Entry'
                size_hint_x: 0.5
                pos_hint: {'x': 0.5 - self.size[0]/(2*self.parent.size[0])}
                on_press:
                    root.transition.direction =  'down'
                    root.current = 'Delete Portfolio Entry'
                    app.delete_portfolio_page(-1)

            CustomButton:
                text: 'Return to Menu'
                pos_hint: {'x': 0.125}
                size_hint_x: 0.75
                on_press:
                    root.transition.direction =  'left'
                    root.current = 'Menu'

    Screen:
        name: 'Add Portfolio Entry'

        Label:
            text: 'Add Portfolio Entry'
            pos_hint: {'center': (0.5, 0.9)}
            size_hint: (1.0,0.1)
            font_size: 24
            text_size: self.size
            halign: 'center'
            valign: 'middle'

        BoxLayout:
            orientation: 'vertical'
            size_hint: (1,0.8)
            pos_hint: {'center': (0.5,0.4)}
            padding: (0, 0, 0, 0)
            spacing: 20

            Label:
                text: 'Please add a new portfolio entry to the database.'
                text_size: self.size
                halign: 'center'
                valign: 'middle'

            Spinner:
                id: spinner_crypto_id
                text: 'Crypto ID'
                values: app.crypto_ids
                size_hint: (0.5,1.0)
                pos_hint: {'x': 0.5 - self.size[0]/(2*self.parent.size[0])}
                on_press:
                    self.values = app.crypto_ids

            Label:
                text: 'Date Purchased'
                text_size: self.size
                halign: 'center'
                valign: 'middle'

            TextInput:
                id: date_text
                hint_text: 'YYYY-MM-DD'
                size_hint_x: 0.8
                pos_hint: {'x': 0.5 - self.size[0]/(2*self.parent.size[0])}

            Label:
                text: 'Quantity Purchased'
                text_size: self.size
                halign: 'center'
                valign: 'middle'

            TextInput:
                id: quantity_text
                input_filter: 'int'
                hint_text: '1'
                size_hint_x: 0.8
                pos_hint: {'x': 0.5 - self.size[0]/(2*self.parent.size[0])}

            CustomButton:
                text: 'Add Portfolio Entry'
                size_hint_x: 0.5
                pos_hint: {'x': 0.5 - self.size[0]/(2*self.parent.size[0])}
                on_press:
                    app.modify_portfolio_entry(root.ids.spinner_crypto_id.text, root.ids.date_text.text, root.ids.quantity_text.text, 'Add')
                    quantity_text = ''
                    date_text = ''

            CustomButton:
                text: 'Return to Portfolio Entries'
                pos_hint: {'x': 0.125}
                size_hint_x: 0.75
                on_press:
                    root.transition.direction =  'down'
                    root.current = 'Portfolio Entries'

    Screen:
        name: 'Update Portfolio Entry'

        Label:
            text: 'Update Portfolio Entry'
            pos_hint: {'center': (0.5, 0.9)}
            size_hint: (1.0,0.1)
            font_size: 24
            text_size: self.size
            halign: 'center'
            valign: 'middle'

        BoxLayout:
            orientation: 'vertical'
            size_hint: (1,0.8)
            pos_hint: {'center': (0.5,0.45)}
            padding: (0, 0, 0, 0)
            spacing: 10

            Label:
                text: 'Please select a portfolio entry to update.'
                text_size: self.size
                halign: 'center'
                valign: 'middle'

            Spinner:
                id: spinner_update_portfolio
                text: '1'
                values: []
                size_hint: (0.5,1.0)
                pos_hint: {'x': 0.5 - self.size[0]/(2*self.parent.size[0])}
                option_cls: 'PortfolioUpdateSpinner'
                on_press:
                    self.values = app.portfolio_info

            Spinner:
                id: update_spinner_crypto_id
                text: 'Crypto ID'
                values: app.crypto_ids
                size_hint: (0.5,1.0)
                pos_hint: {'x': 0.5 - self.size[0]/(2*self.parent.size[0])}
                on_press:
                    self.values = app.crypto_ids

            Label:
                text: 'Date Purchased'
                text_size: self.size
                halign: 'center'
                valign: 'middle'

            TextInput:
                id: update_date_text
                hint_text: 'YYYY-MM-DD'
                size_hint_x: 0.8
                pos_hint: {'x': 0.5 - self.size[0]/(2*self.parent.size[0])}

            Label:
                text: 'Quantity Purchased'
                text_size: self.size
                halign: 'center'
                valign: 'middle'

            TextInput:
                id: update_quantity_text
                input_filter: 'int'
                hint_text: '1'
                size_hint_x: 0.8
                pos_hint: {'x': 0.5 - self.size[0]/(2*self.parent.size[0])}

            CustomButton:
                text: 'Update Portfolio Entry'
                size_hint_x: 0.5
                pos_hint: {'x': 0.5 - self.size[0]/(2*self.parent.size[0])}
                on_press:
                    app.modify_portfolio_entry(root.ids.update_spinner_crypto_id.text,
                    root.ids.update_date_text.text,
                    root.ids.update_quantity_text.text,
                    entry_id=root.ids.spinner_update_portfolio.text,
                    operation='Update'
                    )
                    quantity_text = ''
                    date_text = ''

            CustomButton:
                text: 'Return to Portfolio Entries'
                pos_hint: {'x': 0.125}
                size_hint_x: 0.75
                on_press:
                    root.transition.direction =  'left'
                    root.current = 'Portfolio Entries'

    Screen:
        name: 'Delete Portfolio Entry'

        Label:
            text: 'Delete Portfolio Entry'
            pos_hint: {'center': (0.5, 0.9)}
            size_hint: (1.0,0.1)
            font_size: 24
            text_size: self.size
            halign: 'center'
            valign: 'middle'

        BoxLayout:
            orientation: 'vertical'
            size_hint: (1,0.8)
            pos_hint: {'center': (0.5,0.45)}
            padding: (0, 0, 0, 0)
            spacing: 10

            Label:
                text: 'Please select a portfolio entry to delete.'
                text_size: self.size
                halign: 'center'
                valign: 'middle'

            Spinner:
                id: spinner_delete_portfolio
                text: '1'
                values: []
                size_hint: (0.5,1.0)
                pos_hint: {'x': 0.5 - self.size[0]/(2*self.parent.size[0])}
                option_cls: 'PortfolioDeleteSpinner'
                on_press:
                    self.values = app.portfolio_info

            Label:
                id: delete_crypto_id
                text: 'Crypto ID'
                color: app.outline_color
                outline_color: app.text_color
                size_hint: (0.5,1.0)
                pos_hint: {'x': 0.5 - self.size[0]/(2*self.parent.size[0])}

            Label:
                text: 'Date Purchased'
                text_size: self.size
                halign: 'center'
                valign: 'middle'

            Label:
                id: delete_date_text
                text: 'YYYY-MM-DD'
                color: app.outline_color
                outline_color: app.text_color
                size_hint_x: 0.8
                pos_hint: {'x': 0.5 - self.size[0]/(2*self.parent.size[0])}

            Label:
                text: 'Quantity Purchased'
                text_size: self.size
                halign: 'center'
                valign: 'middle'

            Label:
                id: delete_quantity_text
                text: '0'
                color: app.outline_color
                outline_color: app.text_color
                size_hint_x: 0.8
                pos_hint: {'x': 0.5 - self.size[0]/(2*self.parent.size[0])}

            CustomButton:
                text: 'Delete Portfolio Entry'
                size_hint_x: 0.5
                pos_hint: {'x': 0.5 - self.size[0]/(2*self.parent.size[0])}
                on_press:
                    app.modify_portfolio_entry(
                    entry_id=root.ids.spinner_delete_portfolio.text,
                    operation='Delete'
                    )

            CustomButton:
                text: 'Return to Portfolio Entries'
                pos_hint: {'x': 0.125}
                size_hint_x: 0.75
                on_press:
                    root.transition.direction =  'up'
                    root.current = 'Portfolio Entries'

    Screen:
        name: 'Check Portfolio'
        on_enter:
            app.add_value_check()
        Label:
            text: 'Portfolio Summary'
            pos_hint: {'center': (0.5, 0.9)}
            font_size: 24
            text_size: self.size
            halign: 'center'
            valign: 'middle'

        BoxLayout:
            orientation: 'vertical'
            size_hint: (1,0.8)
            pos_hint: {'center': (0.5,0.4)}
            padding: (0, 0, 0, 50)
            spacing: 20
            Label:
                text: 'Date of Report'
                text_size: self.size
                halign: 'center'
                valign: 'middle'

            Label:
                id: report_date
                text: f'{app.portfolio_report_date}'
                bold: True
                text_size: self.size
                halign: 'center'
                valign: 'middle'

            Label:
                text: 'Total Value'
                text_size: self.size
                halign: 'center'
                valign: 'middle'

            Label:
                id: total_value
                text: f'${app.portfolio_report_total:,.2f}'
                text_size: self.size
                bold: True
                color: app.text_color
                outline_width: 1
                halign: 'center'
                valign: 'middle'
                on_text:
                    self.color = text_color_from_value(self, -100000, 100000)

            Label:
                text: 'Date of Last Report'
                text_size: self.size
                halign: 'center'
                valign: 'middle'

            Label:
                id: last_report_date
                text: f'{app.portfolio_report_previous_date}'
                text_size: self.size
                bold: True
                halign: 'center'
                valign: 'middle'

            Label:
                text: 'Change From Last'
                text_size: self.size
                halign: 'center'
                valign: 'middle'

            Label:
                id: percent_change
                text: f'{app.portfolio_report_change_from_previous:,}% from previous report'
                color: app.text_color
                text_size: self.size
                outline_width: 1
                bold: True
                halign: 'center'
                valign: 'middle'
                on_text:
                    self.color = text_color_from_value(self, -100, 100)

            CustomButton:
                text: 'Return to Menu'
                pos_hint: {'x': 0.125}
                size_hint_x: 0.75
                on_press:
                    root.transition.direction =  'up'
                    root.current = 'Menu'

    Screen
        name: 'Change Color'

        BoxLayout:
            orientation: 'vertical'
            size_hint: (1,0.25)
            pos_hint: {'center': (0.5,0.4)}
            padding: (0, 0, 0, 50)
            spacing: 20

            Spinner:
                id: spinner_color
                text: 'Color Property'
                values: ['Background', 'Outline', 'Text', 'Button']
                size_hint: (0.5,1.0)
                pos_hint: {'x': 0.5 - self.size[0]/(2*self.parent.size[0])}

            TextInput:
                id: color_input
                hint_text: '0.75, 0.25, 0.5, 1.0'
                write_tab: False
                multiline: False
                on_text_validate:
                    app.change_color(root.ids.spinner_color.text, self.text)

        CustomButton:
            text: 'Return to Menu'
            pos_hint: {'center': (0.5,0.125)}
            size_hint: (0.5, 0.125)
            on_press:
                root.transition.direction =  'right'
                root.current = 'Menu'


<Button>
    canvas.before:
        Color:
            rgb: self.background_color
        SmoothRoundedRectangle:
            size: self.size
            pos: self.pos
            radius: [18]
    background_color: app.button_color
    text_size: self.size
    halign: 'center'
    valign: 'middle'

<SpinnerOption>

    background_color: app.button_color

<TextInput>
    write_tab: False
    multiline: False

<Screen>
    canvas.before:
        Color:
            rgba: app.background_color
        Rectangle:
            pos: self.pos
            size: self.size

<Label>
    font_size: 24
    outline_width: 2
    outline_color: app.outline_color
    color: app.text_color
